" Vundle bootstrap 
" Download vundle if it's not there
if !filereadable($HOME . '/.vim/bundle/Vundle.vim/.git/config') && confirm("Clone Vundle?","Y\nn") == 1
    exec '!git clone https://github.com/gmarik/Vundle.vim ~/.vim/bundle/Vundle.vim/'
endif

" ================================================
" Configs for Vundle
" ================================================
set nocompatible
filetype off

" set the runtime path to include Vundle and initialize
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

" let Vundle manage Vundle, required
Plugin 'VundleVim/Vundle.vim'

" Themes
Plugin 'chriskempson/base16-vim'
Plugin 'NLKNguyen/papercolor-theme'
Plugin 'altercation/vim-colors-solarized'
Plugin 'vim-airline/vim-airline'
Plugin 'vim-airline/vim-airline-themes'
Plugin 'yasukotelin/shirotelin'

Plugin 'ctrlpvim/ctrlp.vim'
Plugin 'mileszs/ack.vim'
Plugin 'scrooloose/nerdtree'
Plugin 'scrooloose/nerdcommenter'
Plugin 'terryma/vim-expand-region'
Plugin 'inkarkat/vim-ingo-library'
Plugin 'inkarkat/vim-mark'
Plugin 'dense-analysis/ale'
Plugin 'Chiel92/vim-autoformat'
Plugin 'michaeljsmith/vim-indent-object'
Plugin 'ludovicchabant/vim-gutentags'

Plugin 'tpope/vim-unimpaired'
Plugin 'tpope/vim-fugitive'
Plugin 'airblade/vim-gitgutter'
Plugin 'takac/vim-hardtime'
Plugin 'kana/vim-textobj-user'

" Python specific
Plugin 'mgedmin/python-imports.vim'
"Plugin 'jeetsukumaran/vim-pythonsense'
Plugin 'bps/vim-textobj-python'
Plugin 'tmhedberg/SimpylFold'
Plugin 'vim-scripts/indentpython.vim'
Plugin 'davidhalter/jedi-vim'
Plugin 'jmcantrell/vim-virtualenv'


call vundle#end()            " required
filetype plugin indent on    " required
" To ignore plugin indent changes, instead use:
"filetype plugin on

" Automatic reloading of .vimrc
autocmd! bufwritepost .vimrc source %
autocmd! bufwritepost vimrc source %

" make backspace behave like normal again
set bs=2     

let mapleader = ","

" Quick quit command
noremap <Leader>q :quit<CR>
noremap <Leader>Q :qa!<CR>

" Easier movement within windows
map <c-j> <c-w>j
map <c-k> <c-w>k
map <c-l> <c-w>l
map <c-h> <c-w>h
			
" easier moving between tabs
" map <Leader>n <esc>:tabprevious<CR>
" map <Leader>m <esc>:tabnext<CR>

set tabstop=4
set softtabstop=4
set shiftwidth=4
set shiftround
set expandtab


" ================================================
" My own configs
" ================================================
set scrolloff=3
set hidden

" Use standard regex for searching (via '\v' option)
nnoremap / /\v
vnoremap / /\v

set hlsearch
set incsearch
set ignorecase
set smartcase
set gdefault

set autoindent
set number
set relativenumber
set nobackup
set laststatus=2
set wildmenu
set wildmode=longest:full,full

" Have a better :find experience
set path+=**
set wildignore+=*.pyc

" Open new splits on right or below
set splitbelow
set splitright

" Ale configs
let g:ale_echo_msg_error_str = 'E'
let g:ale_echo_msg_warning_str = 'W'
let g:ale_echo_msg_format = '[%linter%] %s [%severity%]'
let g:ale_linters = {'python': ['flake8']}

" Airline configurations
" let g:airline#extensions#ale#enabled = 1
" let airline#extensions#ale#error_symbol = 'E:'
" let airline#extensions#ale#warning_symbol = 'W:'
let airline_section_b = ""

" Call black-macchiato
nnoremap <Leader>f V<esc>:'<,'> !black-macchiato<cr>
xnoremap <Leader>f <esc>:'<,'> !black-macchiato<cr>

let g:formatters_python = ['black', 'yapf', 'autopep8']
" Use `ag` for ack plugin
if executable('ag')
  let g:ackprg = 'ag --vimgrep'
endif

" clean the search result by hitting escape
nnoremap <silent> <leader><space> :noh<cr>

" open vimrc fast!
:nnoremap <leader>ev :vsplit $MYVIMRC<cr>
:nnoremap <leader>sv :source $MYVIMRC<cr>

" Use space for code folding
set foldmethod=indent
set foldlevel=99
nnoremap <space> za

" Shorter update time (for git gutter)
set updatetime=100

" No docstring window for Jedi
autocmd FileType python setlocal completeopt-=preview

" Use macos clipboard
set clipboard=unnamed

" Disable the welcome message
set shortmess+=I 

" Shortcut to toggle nerdtree
map <f8> :NERDTreeToggle<CR>

" Turn off the annoying bells
set belloff=all



" HardTime configs
let g:hardtime_default_on = 0
let g:hardtime_timeout = 1000
let g:hardtime_showmsg = 0


if has('gui_running')
    set background=light
    colorscheme base16-one-light
    let g:airline_theme='base16'
    set guifont=Menlo\ Regular:h12
    set linespace=2
    " Remove the scrollbars
    set guioptions=
    set cursorline  " highlight current line
else
  "  colorscheme zenburn
end


" Configs for showing invisible chars (tab etc)
nmap <leader>l :set list!<CR>
set listchars=tab:▸\ ,eol:¬  " Same as TextMate

augroup MyGroup
    au FocusLost * silent! wa

    " Python specific
    au FileType python map <silent> <leader>b oimport pdb; pdb.set_trace()<esc>
    au FileType python map <silent> <leader>B Oimport pdb; pdb.set_trace()<esc>
augroup END
